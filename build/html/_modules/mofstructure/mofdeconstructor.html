<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mofstructure.mofdeconstructor &#8212; mofstructure 0.1.7 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=22a50566" />
    <script src="../../_static/documentation_options.js?v=ca7ad2ea"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for mofstructure.mofdeconstructor</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Dr. Dinga Wonanke&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s2">&quot;production&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.local_env</span> <span class="kn">import</span> <span class="n">JmolNN</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.graphs</span> <span class="kn">import</span> <span class="n">StructureGraph</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.ase</span> <span class="kn">import</span> <span class="n">AseAtomsAdaptor</span>
<span class="kn">from</span> <span class="nn">ase.data</span> <span class="kn">import</span> <span class="n">chemical_symbols</span><span class="p">,</span> <span class="n">covalent_radii</span><span class="p">,</span> <span class="n">atomic_numbers</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">neighborlist</span><span class="p">,</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">Atoms</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">openbabel</span> <span class="kn">import</span> <span class="n">pybel</span> <span class="k">as</span> <span class="n">pb</span>
    <span class="kn">from</span> <span class="nn">openbabel</span> <span class="kn">import</span> <span class="n">openbabel</span> <span class="k">as</span> <span class="n">ob</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;install openbabel if you wish to use compute_openbabel_cheminformatic function&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span>
    <span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">rdDetermineBonds</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;install rdkit if you wish to use compute_cheminformatic_from_rdkit function&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="transition_metals">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.transition_metals">[docs]</a>
<span class="k">def</span> <span class="nf">transition_metals</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function that returns the list of all chemical symbols of</span>
<span class="sd">    metallic elements present in the periodic table</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">chemical_symbols</span> <span class="k">if</span> <span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">chemical_symbols</span><span class="p">[</span><span class="n">main_index</span><span class="p">]</span>
                                                                     <span class="k">for</span> <span class="n">main_index</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">86</span><span class="p">]]]</span>
    <span class="k">return</span> <span class="n">metal</span></div>



<div class="viewcode-block" id="inter_atomic_distance_check">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.inter_atomic_distance_check">[docs]</a>
<span class="k">def</span> <span class="nf">inter_atomic_distance_check</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function that checks whether two atoms are within a distance 1.0 Amstrong unless it is an R-H bond</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom : ASE atoms object</span>

<span class="sd">    **returns**</span>
<span class="sd">        boolean :</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="o">.</span><span class="n">get_all_distances</span><span class="p">(</span><span class="n">mic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">!=</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.90</span><span class="p">:</span>
                        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
    <span class="k">return</span> <span class="n">valid</span></div>



<div class="viewcode-block" id="covalent_radius">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.covalent_radius">[docs]</a>
<span class="k">def</span> <span class="nf">covalent_radius</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function that returns the covalent radius from the chemical symbol</span>
<span class="sd">    of an element.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        element: chemical symbol of an atom</span>
<span class="sd">        type.string</span>

<span class="sd">    **returns:**</span>
<span class="sd">        covalent_radii: covalent radius of the elements.</span>
<span class="sd">        type.float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">a_n</span> <span class="o">=</span> <span class="n">atomic_numbers</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">covalent_radii</span><span class="p">[</span><span class="n">a_n</span><span class="p">]</span></div>



<div class="viewcode-block" id="ase_2_xyz">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.ase_2_xyz">[docs]</a>
<span class="k">def</span> <span class="nf">ase_2_xyz</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an xyz string from an ase atom object to be compatible with</span>
<span class="sd">    pybel in order to perfom some cheminformatics.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        atoms : ASE atoms object</span>

<span class="sd">    **returns:**</span>
<span class="sd">        a_str : string block of the atom object in xyz format</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot; Does not support periodic systems!&quot;</span><span class="p">)</span>
    <span class="n">num_of_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    <span class="n">all_chemical_symbols</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()</span>
    <span class="n">all_atoms</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_chemical_symbols</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span>
    <span class="n">a_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_of_atoms</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">all_atoms</span><span class="p">:</span>
        <span class="n">a_str</span> <span class="o">+=</span> <span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">a_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>



<div class="viewcode-block" id="obmol_2_rdkit">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.obmol_2_rdkit">[docs]</a>
<span class="k">def</span> <span class="nf">obmol_2_rdkit</span><span class="p">(</span><span class="n">obmol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple function to convert openbabel mol to RDkit mol</span>
<span class="sd">    A function that takes an openbabel molecule object and</span>
<span class="sd">    converts it to an RDkit molecule object. The importance of this</span>
<span class="sd">    function lies in the fact that there is no direct were to convert from</span>
<span class="sd">    an ase atom type to an rdkit molecule object. Consequently, the easiest</span>
<span class="sd">    approach it is firt convert the system to an openbabel molecule object</span>
<span class="sd">    using the function ase_2_pybel to convert to the pybel molecule object.</span>
<span class="sd">    Then using the following code obmol = pybel_mol.OBMol to obtain the</span>
<span class="sd">    openbabel molecule object that can then be used to convert to the</span>
<span class="sd">    rdkit molecule object.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        obmol : openbabel molecule object</span>

<span class="sd">    **returns:**</span>
<span class="sd">        rdmol : rdkit molecule object.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">obconverted</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">OBConversion</span><span class="p">()</span>
    <span class="n">obconverted</span><span class="o">.</span><span class="n">SetOutFormat</span><span class="p">(</span><span class="s1">&#39;sdf&#39;</span><span class="p">)</span>
    <span class="n">outmdl</span> <span class="o">=</span> <span class="n">obconverted</span><span class="o">.</span><span class="n">WriteString</span><span class="p">(</span><span class="n">obmol</span><span class="p">)</span>
    <span class="n">rdmol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromMolBlock</span><span class="p">(</span><span class="n">outmdl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rdmol</span></div>



<div class="viewcode-block" id="compute_inchis">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.compute_inchis">[docs]</a>
<span class="k">def</span> <span class="nf">compute_inchis</span><span class="p">(</span><span class="n">obmol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function to compute the cheminformatic inchi and inchikey using</span>
<span class="sd">    openbabel. The inchi and inchikey are IUPAC cheminformatic identifiers</span>
<span class="sd">    of molecules. They are important to easily search for molecules in databases.</span>
<span class="sd">    For MOFs, this is quite important to search for different secondary building units</span>
<span class="sd">    (sbu) and ligands found in the MOF.</span>
<span class="sd">    More about inchi can be found in the following link</span>

<span class="sd">    https://iupac.org/who-we-are/divisions/division-details/inchi</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        obmol: openbabel molecule object</span>

<span class="sd">    **returns:**</span>
<span class="sd">        inChi, inChiKey: iupac inchi and inchikeys for thesame molecule.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">conv</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">OBConversion</span><span class="p">()</span>
    <span class="n">conv</span><span class="o">.</span><span class="n">SetOutFormat</span><span class="p">(</span><span class="s2">&quot;inchi&quot;</span><span class="p">)</span>
    <span class="n">inChi</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">WriteString</span><span class="p">(</span><span class="n">obmol</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">inChi</span> <span class="o">=</span> <span class="n">inChi</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;InChI=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">conv</span><span class="o">.</span><span class="n">SetOptions</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="n">conv</span><span class="o">.</span><span class="n">OUTOPTIONS</span><span class="p">)</span>
    <span class="n">inChiKey</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">WriteString</span><span class="p">(</span><span class="n">obmol</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">inChi</span><span class="p">,</span>  <span class="n">inChiKey</span></div>



<div class="viewcode-block" id="compute_smi">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.compute_smi">[docs]</a>
<span class="k">def</span> <span class="nf">compute_smi</span><span class="p">(</span><span class="n">obmol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function to compute the SMILES (Simplified molecular-input line-entry system) notation</span>
<span class="sd">    of a molecule using openbabel. The SMILES is a line notation method that uses ASCII strings to represent</span>
<span class="sd">    molecules. More about SMILES can be found in the following link</span>
<span class="sd">    https://en.wikipedia.org/wiki/Simplified_molecular-input_line-entry_system</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        obmol : openbabel molecule object</span>

<span class="sd">    **returns:**</span>
<span class="sd">        smi: SMILES notatation of the molecule.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">conv</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">OBConversion</span><span class="p">()</span>
    <span class="n">conv</span><span class="o">.</span><span class="n">SetOutFormat</span><span class="p">(</span><span class="s2">&quot;smi&quot;</span><span class="p">)</span>
    <span class="n">smi</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">WriteString</span><span class="p">(</span><span class="n">obmol</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">smi</span></div>



<div class="viewcode-block" id="ase_2_pybel">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.ase_2_pybel">[docs]</a>
<span class="k">def</span> <span class="nf">ase_2_pybel</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    As simple script to convert from ase atom object to pybel. There are</span>
<span class="sd">    many functionalities like atom typing, bond typing and autmatic addition of</span>
<span class="sd">    hydrogen that can be performed on a pybel molecule object, which can not be</span>
<span class="sd">    directly performed on an ase atom object.</span>
<span class="sd">    E.g\n</span>
<span class="sd">    add_hygrogen = pybel.addh()\n</span>
<span class="sd">    remove_hydrogen = pybel.removeh()\n</span>
<span class="sd">    https://openbabel.org/docs/dev/UseTheLibrary/Python_Pybel.html</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        atoms : ASE atoms object</span>

<span class="sd">    **returns:**</span>
<span class="sd">        pybel: pybel molecular object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_str</span> <span class="o">=</span> <span class="n">ase_2_xyz</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    <span class="n">pybel_mol</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">readstring</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="n">a_str</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pybel_mol</span></div>



<div class="viewcode-block" id="max_index">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.max_index">[docs]</a>
<span class="k">def</span> <span class="nf">max_index</span><span class="p">(</span><span class="n">lists</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Extract index of list with the maximum element</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lists</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">elt</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">lists</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">i</span></div>



<div class="viewcode-block" id="compute_openbabel_cheminformatic">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.compute_openbabel_cheminformatic">[docs]</a>
<span class="k">def</span> <span class="nf">compute_openbabel_cheminformatic</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function the returns all smiles, inchi and inchikeys</span>
<span class="sd">    from an ase_atom object. The function starts by wrapping</span>
<span class="sd">    the system, which is important for systems in which minimum</span>
<span class="sd">    image convertion has made atoms appear to be uncoordinated</span>
<span class="sd">    at random positions. The wrap functions coordinates all the</span>
<span class="sd">    atoms together.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        atoms : ASE atoms object</span>

<span class="sd">    **returns:**</span>
<span class="sd">        smi, inChi, inChiKey</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">new_ase_atom</span> <span class="o">=</span> <span class="n">wrap_systems_in_unit_cell</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>

    <span class="n">new_ase_atom</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pybel_mol</span> <span class="o">=</span> <span class="n">ase_2_pybel</span><span class="p">(</span><span class="n">new_ase_atom</span><span class="p">)</span>

    <span class="n">obmol</span> <span class="o">=</span> <span class="n">pybel_mol</span><span class="o">.</span><span class="n">OBMol</span>
    <span class="n">inChi</span><span class="p">,</span>  <span class="n">inChiKey</span> <span class="o">=</span> <span class="n">compute_inchis</span><span class="p">(</span><span class="n">obmol</span><span class="p">)</span>
    <span class="n">smi</span> <span class="o">=</span> <span class="n">compute_smi</span><span class="p">(</span><span class="n">obmol</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">smi</span><span class="p">,</span> <span class="n">inChi</span><span class="p">,</span> <span class="n">inChiKey</span></div>



<div class="viewcode-block" id="compute_cheminformatic_from_rdkit">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.compute_cheminformatic_from_rdkit">[docs]</a>
<span class="k">def</span> <span class="nf">compute_cheminformatic_from_rdkit</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function that converts and ase atom into rkdit mol to extract some cheminformatic</span>
<span class="sd">    information.The script begins by taking an ase atom an creating an xyz string</span>
<span class="sd">    of the molecule, which is stored to memory. The xyz string is then read using</span>
<span class="sd">    the MolFromXYZBlock function in rdkit, which reads an xyz string of the molecule.</span>
<span class="sd">    However, this does not include any of the bonding information. To do this the following</span>
<span class="sd">    commands are parsed to the rdkit mol,bond_moll = Chem.Mol(rdmol)</span>
<span class="sd">    rdDetermineBonds.DetermineBonds(bond_moll,charge=0)</span>
<span class="sd">    https://github.com/rdkit/UGM_2022/blob/main/Notebooks/Landrum_WhatsNew.ipynb</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ASE atoms</span>

<span class="sd">    **returns:**</span>
<span class="sd">        smile string, inchi, inchikey</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">ase_atom</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">()):</span>
        <span class="n">ase_atom</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">xyz_string</span> <span class="o">=</span> <span class="n">ase_2_xyz</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>
    <span class="n">rdxyz</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromXYZBlock</span><span class="p">(</span><span class="n">xyz_string</span><span class="p">)</span>
    <span class="n">rdmol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">(</span><span class="n">rdxyz</span><span class="p">)</span>
    <span class="n">rdDetermineBonds</span><span class="o">.</span><span class="n">DetermineConnectivity</span><span class="p">(</span><span class="n">rdmol</span><span class="p">)</span>
    <span class="n">rdDetermineBonds</span><span class="o">.</span><span class="n">DetermineBonds</span><span class="p">(</span><span class="n">rdmol</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">smi</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">RemoveHs</span><span class="p">(</span><span class="n">rdmol</span><span class="p">))</span>
    <span class="n">inChi</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">inchi</span><span class="o">.</span><span class="n">MolToInchi</span><span class="p">(</span><span class="n">rdmol</span><span class="p">)</span>
    <span class="n">inChiKey</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">inchi</span><span class="o">.</span><span class="n">MolToInchiKey</span><span class="p">(</span><span class="n">rdmol</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">smi</span><span class="p">,</span> <span class="n">inChi</span><span class="p">,</span> <span class="n">inChiKey</span></div>



<div class="viewcode-block" id="compute_ase_neighbour">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.compute_ase_neighbour">[docs]</a>
<span class="k">def</span> <span class="nf">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a connectivity graph using ASE neigbour list.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ASE atoms</span>

<span class="sd">    **returns:**</span>
<span class="sd">        1.  atom_neighbors:</span>
<span class="sd">            A python dictionary, wherein each atom index</span>
<span class="sd">            is key and the value are the indices of it neigbours.</span>
<span class="sd">            e.g.</span>
<span class="sd">            atom_neighbors ={0:[1,2,3,4], 1:[3,4,5]...}</span>

<span class="sd">        2.  matrix:</span>
<span class="sd">            An adjacency matrix that wherein each row correspond to</span>
<span class="sd">            to an atom index and the colums correspond to the interaction</span>
<span class="sd">            between that atom to the other atoms. The entries in the</span>
<span class="sd">            matrix are 1 or 0. 1 implies bonded and 0 implies not bonded.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">atom_neighbors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cut_off</span> <span class="o">=</span> <span class="n">neighborlist</span><span class="o">.</span><span class="n">natural_cutoffs</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>

    <span class="n">neighbor_list</span> <span class="o">=</span> <span class="n">neighborlist</span><span class="o">.</span><span class="n">NeighborList</span><span class="p">(</span><span class="n">cut_off</span><span class="p">,</span>
                                              <span class="n">self_interaction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                              <span class="n">bothways</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">neighbor_list</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">neighbor_list</span><span class="o">.</span><span class="n">get_connectivity_matrix</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="n">connectivity</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">neighbor_list</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">atom_neighbors</span><span class="p">[</span><span class="n">atoms</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">connectivity</span>

    <span class="k">return</span> <span class="n">atom_neighbors</span><span class="p">,</span> <span class="n">matrix</span></div>



<div class="viewcode-block" id="matrix2dict">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.matrix2dict">[docs]</a>
<span class="k">def</span> <span class="nf">matrix2dict</span><span class="p">(</span><span class="n">bond_matrix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple procedure to convert an adjacency matrix into</span>
<span class="sd">    a python dictionary.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        bond matrix : adjacency matrix, type: nxn ndarray</span>

<span class="sd">    **returns:**</span>
<span class="sd">        graph: python dictionary</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bond_matrix</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">graph</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="k">return</span> <span class="n">graph</span></div>



<div class="viewcode-block" id="dfsutil_graph_method">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.dfsutil_graph_method">[docs]</a>
<span class="k">def</span> <span class="nf">dfsutil_graph_method</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">visited</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Depth-first search graph algorithm for traversing graph data structures.</span>
<span class="sd">    I starts at the root &#39;node&#39; and explores as far as possible along</span>
<span class="sd">    each branch before backtracking.</span>
<span class="sd">    It is used here a a util for searching connected components in the MOF graph</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        graph: any python dictionary</span>
<span class="sd">        temp: a python list to hold nodes that have been visited</span>
<span class="sd">        node: a key in the python dictionary (graph), which is used as the starting or root node</span>
<span class="sd">        visited: python list containing nodes that have been traversed.</span>

<span class="sd">    **returns:**</span>
<span class="sd">        python dictionary</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">visited</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">visited</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">dfsutil_graph_method</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">visited</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">temp</span></div>



<div class="viewcode-block" id="longest_list">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.longest_list">[docs]</a>
<span class="k">def</span> <span class="nf">longest_list</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    return longest list in list of list</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span></div>



<div class="viewcode-block" id="remove_unbound_guest_and_return_unique">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.remove_unbound_guest_and_return_unique">[docs]</a>
<span class="k">def</span> <span class="nf">remove_unbound_guest_and_return_unique</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple script to remove guest from a metal organic framework.</span>
<span class="sd">    1)It begins by computing a connected graph component of all the fragments in the system</span>
<span class="sd">    using ASE neighbour list.</span>
<span class="sd">    2) Secondly it selects indicies of connected components which contain a metal</span>
<span class="sd">    3)if the there are two or more components, we create a pytmagen graph for each components and filter out all components that are not polymeric</span>
<span class="sd">    4) If there are two or more polymeric components, we check wether these systems there are identical or different and select only unique polymeric components</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ASE atoms</span>

<span class="sd">    **returns:**</span>

<span class="sd">        mof_indices : indinces of the guest free system. The guest free ase_atom object</span>
<span class="sd">        can be obtain as follows; E.g. guest_free_system = ase_atom[mof_indices]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">atom_neighbors</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>
    <span class="n">fragments</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">atom_neighbors</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fragments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">polymeric_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fragments</span><span class="p">)):</span>
            <span class="n">super_cell</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">fragments</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">coordination_graph</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">super_cell</span><span class="p">)</span>
            <span class="n">pymat_graph</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">coordination_graph</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pymat_graph</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">polymeric_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymeric_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Graphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">StructureGraph</span><span class="o">.</span><span class="n">from_local_env_strategy</span><span class="p">(</span><span class="n">AseAtomsAdaptor</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span>
                <span class="n">ase_atom</span><span class="p">[</span><span class="n">fragments</span><span class="p">[</span><span class="n">i</span><span class="p">]]),</span> <span class="n">JmolNN</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">polymeric_indices</span><span class="p">]</span>
            <span class="n">temp_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">polymeric_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="p">[</span><span class="n">Graphs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polymeric_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="n">Graphs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">[</span><span class="n">graph</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">unique</span><span class="p">]:</span>
                    <span class="n">unique</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Graphs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">temp_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polymeric_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">mof_indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">frag_indices</span> <span class="ow">in</span> <span class="n">temp_indices</span><span class="p">:</span>
                <span class="n">mof_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fragments</span><span class="p">[</span><span class="n">frag_indices</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mof_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">longest_list</span><span class="p">(</span><span class="n">fragments</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mof_indices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fragments</span><span class="p">,</span> <span class="p">[])</span></div>



<div class="viewcode-block" id="remove_unbound_guest">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.remove_unbound_guest">[docs]</a>
<span class="k">def</span> <span class="nf">remove_unbound_guest</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple script to remove guest from a metal organic framework.</span>
<span class="sd">    1) It begins by computing a connected graph component of all the fragments in the system using ASE neighbour list.</span>
<span class="sd">    2) Secondly it selects indices of connected components which contain a metal</span>
<span class="sd">    3) if the there are two or more components, we create a pytmagen graph for each components and filter out all components that are not polymeric</span>
<span class="sd">    4) If there are two or more polymeric components, we check whether these systems there are identical or different and select all polymeric components</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ASE atoms</span>

<span class="sd">    **returns:**</span>
<span class="sd">        mof_indices: indices of the guest-free system. The guest-free ase_atom object</span>
<span class="sd">        can be obtained as follows; E.g.:: guest_free_system = ase_atom[mof_indices]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">atom_neighbors</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>
    <span class="n">fragments</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">atom_neighbors</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fragments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">polymeric_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fragments</span><span class="p">)):</span>
            <span class="n">super_cell</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">fragments</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">coordination_graph</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">super_cell</span><span class="p">)</span>
            <span class="n">pymat_graph</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">coordination_graph</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pymat_graph</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">polymeric_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymeric_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mof_indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">poly_index</span> <span class="ow">in</span> <span class="n">polymeric_indices</span><span class="p">:</span>
                <span class="n">mof_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fragments</span><span class="p">[</span><span class="n">poly_index</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mof_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">longest_list</span><span class="p">(</span><span class="n">fragments</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mof_indices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fragments</span><span class="p">,</span> <span class="p">[])</span></div>



<div class="viewcode-block" id="connected_components">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.connected_components">[docs]</a>
<span class="k">def</span> <span class="nf">connected_components</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Find the connected fragments in a graph. Should work for any graph defined as a dictionary</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        A graph in the form of dictionary e.g.::</span>
<span class="sd">        graph = {1:[0,1,3], 2:[2,4,5]}</span>

<span class="sd">    **returns:**</span>
<span class="sd">        returns a python list of list of connected components</span>
<span class="sd">        These correspond to individual molecular fragments.</span>
<span class="sd">        list_of_connected_components = [[1,2],[1,3,4]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">visited</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_of_connected_components</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">visited</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">visited</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">list_of_connected_components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">dfsutil_graph_method</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">visited</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">list_of_connected_components</span></div>



<div class="viewcode-block" id="check_planarity">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.check_planarity">[docs]</a>
<span class="k">def</span> <span class="nf">check_planarity</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple procedure to check whether a point is planar to three other points.</span>
<span class="sd">    Important to distinguish porphyrin type metals</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        p1, p2, p3, p4 : ndarray containing x,y,z values</span>

<span class="sd">    **returns:**</span>
<span class="sd">        Boolean</span>
<span class="sd">        True: planar</span>
<span class="sd">        False: noneplanar</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">planar</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">p3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">p3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">p3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># \------------------------------------------------</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">-</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">c1</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">c2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">a2</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="o">-</span><span class="n">a</span> <span class="o">*</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># \------------------------------------------------</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">a</span> <span class="o">*</span> <span class="n">p4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">p4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">p4</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">verify</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">+</span> <span class="n">d</span>
    <span class="c1"># \------------------------------------------------</span>
    <span class="k">if</span> <span class="n">verify</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">planar</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">planar</span></div>



<div class="viewcode-block" id="metal_in_porphyrin">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.metal_in_porphyrin">[docs]</a>
<span class="k">def</span> <span class="nf">metal_in_porphyrin</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A funtion to check whether a metal is found at the centre of a phorphirin.</span>
<span class="sd">    The function specifically identifies metal atoms that</span>
<span class="sd">    are coordinated with four nitrogen atoms, as typically seen in porphyrin complexes.</span>
<span class="sd">    These atoms must also satisfy the planarity condition of the porphyrin structure.</span>

<span class="sd">    https://en.wikipedia.org/wiki/Transition_metal_porphyrin_complexes</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>
<span class="sd">        graph: python dictionary containing neigbours</span>

<span class="sd">    **returns:**</span>
<span class="sd">        list of indices consisting of index of metal atoms found in the ASE atom</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">all_porphyrin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_metal_symbols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ase_atom</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">all_metal_symbols</span><span class="p">:</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">all_nitrogens</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_nitrogens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">all_nitrogens</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">all_nitrogens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                                                           <span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">all_nitrogens</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">all_nitrogens</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">position</span>
            <span class="n">planarity</span> <span class="o">=</span> <span class="n">check_planarity</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">planarity</span><span class="p">:</span>
                <span class="n">all_porphyrin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="n">all_porphyrin</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">all_nitrogens</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_porphyrin</span></div>



<div class="viewcode-block" id="metal_in_porphyrin2">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.metal_in_porphyrin2">[docs]</a>
<span class="k">def</span> <span class="nf">metal_in_porphyrin2</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    https://en.wikipedia.org/wiki/Transition_metal_porphyrin_complexes</span>
<span class="sd">    Check whether a metal is found at the centre of a phorphirin</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>
<span class="sd">        graph: python dictionary containing neigbours</span>

<span class="sd">    **returns:**</span>
<span class="sd">        list of indices consisting of index of metal atoms found in the ASE atom</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">old_list_of_connected_components</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="n">all_porphyrin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_metal_symbols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ase_atom</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
    <span class="n">metal_tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">N_tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">all_metal_symbols</span><span class="p">:</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">all_nitrogens</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_nitrogens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">metal_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">N_tmp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">all_nitrogens</span><span class="p">)</span>
    <span class="n">new_atom_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ase_atom</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metal_tmp</span><span class="p">]</span>
    <span class="n">tmp_atom</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">new_atom_indices</span><span class="p">]</span>
    <span class="n">atom_neighbors</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">tmp_atom</span><span class="p">)</span>
    <span class="n">list_of_connected_components</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">atom_neighbors</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_connected_components</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_list_of_connected_components</span><span class="p">):</span>
        <span class="n">all_porphyrin</span> <span class="o">=</span> <span class="n">metal_tmp</span> <span class="o">+</span> <span class="n">N_tmp</span>
    <span class="k">return</span> <span class="n">all_porphyrin</span></div>



<div class="viewcode-block" id="move2front">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.move2front">[docs]</a>
<span class="k">def</span> <span class="nf">move2front</span><span class="p">(</span><span class="n">index_value</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Move an index from any position in the list to the front</span>
<span class="sd">    The function is important to set the cell of a rodmof to point in thea-axis. Such that the system can be grow along this axis</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        index_value: index of item to move to the from</span>
<span class="sd">        coords: list of coords</span>

<span class="sd">    **returns:**</span>
<span class="sd">        list of coords</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index_value</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index_value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">coords</span></div>



<div class="viewcode-block" id="find_carboxylates">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.find_carboxylates">[docs]</a>
<span class="k">def</span> <span class="nf">find_carboxylates</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple aglorimth to search for carboxylates found in the system.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>

<span class="sd">    **returns:**</span>
<span class="sd">        dictionary of key = carbon index and values = oxygen index</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">carboxyl</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">index</span>
            <span class="n">oxygen</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxygen</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">oxy_metal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oxygen</span><span class="p">],</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxy_metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">carboxyl</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">oxygen</span>
    <span class="k">return</span> <span class="n">carboxyl</span></div>



<div class="viewcode-block" id="find_carbonyl_sulphate">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.find_carbonyl_sulphate">[docs]</a>
<span class="k">def</span> <span class="nf">find_carbonyl_sulphate</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple aglorimth to search for Carbonyl sulphate  found in the system.</span>
<span class="sd">    ::</span>
<span class="sd">        O</span>
<span class="sd">        |</span>
<span class="sd">     -C-S</span>
<span class="sd">        |</span>
<span class="sd">        O</span>
<span class="sd">        </span>
<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>

<span class="sd">    **returns:**</span>
<span class="sd">        dictionary of key = carbon index and values = oxygen index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sulphate</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">index</span>
            <span class="n">oxygen</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
            <span class="n">carbon</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxygen</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">oxy_metal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oxygen</span><span class="p">],</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxy_metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">carbon</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">sulphate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">oxygen</span>
    <span class="k">return</span> <span class="n">sulphate</span></div>



<div class="viewcode-block" id="find_sulfides">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.find_sulfides">[docs]</a>
<span class="k">def</span> <span class="nf">find_sulfides</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple aglorimth to search for sulfides.</span>
<span class="sd">    ::</span>
<span class="sd">        S</span>
<span class="sd">        |</span>
<span class="sd">       -C</span>
<span class="sd">        |</span>
<span class="sd">        S</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>

<span class="sd">    **returns:**</span>
<span class="sd">        dictionary of key = carbon index and values = sulphur index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sulfides</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">metals</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">index</span>
            <span class="n">sulphure_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                              <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sulphure_atoms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">sulphure_to_metal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sulphure_atoms</span><span class="p">],</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sulphure_to_metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sulfides</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">sulphure_atoms</span>
                    <span class="n">metals</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">sulphure_to_metal</span>
    <span class="k">return</span> <span class="n">sulfides</span></div>



<div class="viewcode-block" id="find_phosphite">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.find_phosphite">[docs]</a>
<span class="k">def</span> <span class="nf">find_phosphite</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple aglorimth to search for sulfides.</span>
<span class="sd">    ::</span>
<span class="sd">        P</span>
<span class="sd">        |</span>
<span class="sd">       -C</span>
<span class="sd">        |</span>
<span class="sd">        P</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>

<span class="sd">    **returns:**</span>
<span class="sd">        dictionary of key = carbon index and values = phosphorous index</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">phosphorous</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">index</span>
            <span class="n">phosphorous_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                                 <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">phosphorous_atoms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">phosphorous_to_metal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">phosphorous_atoms</span><span class="p">],</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">phosphorous_to_metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">phosphorous</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">phosphorous_atoms</span>
    <span class="k">return</span> <span class="n">phosphorous</span></div>



<div class="viewcode-block" id="find_COS">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.find_COS">[docs]</a>
<span class="k">def</span> <span class="nf">find_COS</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple aglorimth to search for COS.</span>
<span class="sd">    ::</span>
<span class="sd">        O</span>
<span class="sd">        |</span>
<span class="sd">       -C</span>
<span class="sd">        |</span>
<span class="sd">        S</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>

<span class="sd">    **returns:**</span>
<span class="sd">        dictionary of key = carbon index and values = sulphur index</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">sulfides</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">index</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">sulphure_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                                  <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">]</span>
                <span class="n">oxygen_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sulphure_atoms</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxygen_atoms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">sulphure_to_metal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="p">[[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sulphure_atoms</span><span class="p">],</span> <span class="p">[])</span>
                    <span class="n">oxygen_to_metal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="p">[[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oxygen_atoms</span><span class="p">],</span> <span class="p">[])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sulphure_to_metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxygen_to_metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">sulfides</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">sulphure_atoms</span> <span class="o">+</span> <span class="n">oxygen_atoms</span>
    <span class="k">return</span> <span class="n">sulfides</span></div>



<div class="viewcode-block" id="find_phosphate">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.find_phosphate">[docs]</a>
<span class="k">def</span> <span class="nf">find_phosphate</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple algorithm to search for Carbonyl sulphate found in the system.</span>
<span class="sd">    ::</span>
<span class="sd">       O</span>
<span class="sd">       |</span>
<span class="sd">      -P-o</span>
<span class="sd">       |</span>
<span class="sd">       O</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>

<span class="sd">    **returns**</span>
<span class="sd">        dictionary of key = carbon index and values = oxygen index</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">phosphate</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">index</span>
            <span class="n">oxygen</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxygen</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">oxy_metal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oxygen</span><span class="p">],</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxy_metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">phosphate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">oxygen</span>
    <span class="k">return</span> <span class="n">phosphate</span></div>



<div class="viewcode-block" id="secondary_building_units">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.secondary_building_units">[docs]</a>
<span class="k">def</span> <span class="nf">secondary_building_units</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1) Search for all carboxylate that are connected to a metal.</span>
<span class="sd">       Cut at the position between the carboxylate carbon and the adjecent carbon.</span>
<span class="sd">    2) Find all Nitrogen connected to metal. Check whether the nitrogen is in the</span>
<span class="sd">       centre of a porphirin ring. If no, cut at nitrogen metal bond.</span>
<span class="sd">    3) Look for oxygen that is connected to metal and two carbon. cut at metal oxygen bond</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>

<span class="sd">    **returns:**</span>
<span class="sd">        list_of_connected_components: list of connected components,in which each list contains atom indices</span>
<span class="sd">        atom_pairs_at_breaking_point : Dictionary containing point of disconnection Porphyrin_checker: Boolean showing whether the metal is in the centre of a porpherin</span>
<span class="sd">        Regions: Dictionary of regions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">graph</span><span class="p">,</span> <span class="n">bond_matrix</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>
    <span class="n">porphyrin_checker</span> <span class="o">=</span> <span class="n">metal_in_porphyrin2</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">atom_pairs_at_breaking_point</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">all_regions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">bonds_to_break</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">carboxylates</span> <span class="o">=</span> <span class="n">find_carboxylates</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">all_sulphates</span> <span class="o">=</span> <span class="n">find_carbonyl_sulphate</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">all_phosphites</span> <span class="o">=</span> <span class="n">find_phosphite</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">all_sulphites</span> <span class="o">=</span> <span class="n">find_sulfides</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">cos_group</span> <span class="o">=</span> <span class="n">find_COS</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">ferocene_metal</span> <span class="o">=</span> <span class="n">all_ferrocene_metals</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">all_metals</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ase_atom</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
    <span class="n">all_metals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_metals</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="o">+</span><span class="n">porphyrin_checker</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">carboxylates</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">all_carbon_indices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
            <span class="n">all_nitrogens</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>
            <span class="n">S_indx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_carbon_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">all_carbon_indices</span><span class="p">)</span>
                <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_carbon_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_nitrogens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">all_nitrogens</span><span class="p">)</span>
                <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_nitrogens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">S_indx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">S_indx</span><span class="p">)</span>
                <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_indx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">oxygens</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
            <span class="n">carbon_metal</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
            <span class="n">carbon_metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">carbon_metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxygens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">oxy_metal</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oxygens</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                <span class="n">oxy_metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">oxy_metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oxy_metal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">oxygens</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">oxy_metal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">oxygens</span><span class="p">]</span> <span class="o">+</span> <span class="n">oxy_metal</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">carbon_metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">carbon_metal</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">met</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_sulphates</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">all_carbon_indices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
            <span class="n">oxygen</span> <span class="o">=</span> <span class="n">all_sulphates</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_carbon_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_carbon_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">all_carbon_indices</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_carbon_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">oxy</span> <span class="ow">in</span> <span class="n">oxygen</span><span class="p">:</span>
                    <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">oxy</span><span class="p">]</span>
                             <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                    <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                            <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">oxy</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                            <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">oxy</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">met</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_phosphites</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">all__n_indices</span> <span class="o">=</span> <span class="n">all_phosphites</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all__n_indices</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">neigbour</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">:</span>
                <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">neigbour</span>
                <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">neigbour</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_sulphites</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">all__n_indices</span> <span class="o">=</span> <span class="n">all_sulphites</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all__n_indices</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">neigbour</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">:</span>
                <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">neigbour</span>
                <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">neigbour</span><span class="p">])</span>

        <span class="c1"># if atoms in list(all_sulphites.keys()):</span>
        <span class="c1">#     all__n_indices = all_sulphites[atoms]</span>
        <span class="c1">#     neigbours = sum([graph[i].tolist() for i in all__n_indices], [])</span>
        <span class="c1">#     metals = [</span>
        <span class="c1">#         i for i in neigbours if ase_atom[i].symbol in transition_metals()]</span>
        <span class="c1">#     metals = [i for i in metals if i not in ferocene_metal]</span>
        <span class="c1">#     if len(metals) &gt; 0:</span>
        <span class="c1">#         for met in metals:</span>
        <span class="c1">#             atom_pairs_at_breaking_point[atoms] = met</span>
        <span class="c1">#             bonds_to_break.append([atoms] + [met])</span>

        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">cos_group</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">all_carbon_indices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
            <span class="n">non_metals</span> <span class="o">=</span> <span class="n">cos_group</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_carbon_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_carbon_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">all_carbon_indices</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_carbon_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">atom_idx</span> <span class="ow">in</span> <span class="n">non_metals</span><span class="p">:</span>
                    <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">atom_idx</span><span class="p">]</span>
                             <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                    <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                            <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atom_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                            <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atom_idx</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">met</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">carboxylates</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                       <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_sulphates</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                       <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">cos_group</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">atoms</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                <span class="n">Nitrogen</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>
                <span class="n">carbon</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span>
                          <span class="o">==</span> <span class="s1">&#39;C&#39;</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">carboxylates</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">carbon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">carbon</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">carbon</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">carbon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">metal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">metal</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Nitrogen</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">n_carbon</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">Nitrogen</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">carboxylates</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
                    <span class="n">n_nitrogen</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">Nitrogen</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                  <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>
                    <span class="n">n_sulphur</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">Nitrogen</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                 <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_sulphates</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_carbon</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nitrogen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">Nitrogen</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_nitrogen</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nitrogen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">Nitrogen</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_sulphur</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nitrogen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">Nitrogen</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
            <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">atoms</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">porphyrin_checker</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">metal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="n">metal</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">carboxylates</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                       <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_sulphates</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                       <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_sulphites</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                       <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">cos_group</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="p">[]</span>
                       <span class="p">)</span>
            <span class="k">if</span> <span class="n">atoms</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                        <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                        <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">,</span> <span class="n">met</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
            <span class="c1"># Find the carbon closest to P, which is not bonded to a metal and cut</span>
            <span class="c1"># 1) Look for phosphorous atoms</span>
            <span class="c1"># 2) Look for all it&#39;s neigbours</span>
            <span class="c1"># 3) Look for neigbours that are not connected to metal or hydrogen.</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_phosphites</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">atoms</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
                <span class="c1"># not_connected_to_metal_or_hygrogen = [[i for i in graph[j] if ase_atom[i].symbol not in transition_metals() or ase_atom[i].symbol != &#39;H&#39;] for j in connected]</span>

                <span class="n">metal_oxy</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">]</span>

                <span class="n">metal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">metal_oxy</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                <span class="n">closest_atoms</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">atoms</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">],</span> <span class="p">[])</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">all_carbon_indices</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">]</span>
                                              <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">closest_atoms</span><span class="p">],</span> <span class="p">[])</span>
                    <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">all_carbon_indices</span><span class="p">:</span>
                        <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">frag</span>
                        <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">frag</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">,</span> <span class="n">frag</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
            <span class="c1"># Find the carbon closest to P, which is  bonded to a metal and cut</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
                         <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
            <span class="n">metal_oxy</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">]</span>

            <span class="n">metal_connect</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">metal_oxy</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal_connect</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">metal_connect</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">frag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frag</span><span class="p">)</span>
    <span class="c1"># In special cases some carbon and hydrogen get very closed to metals</span>
    <span class="c1"># So in such case it is important to clear this</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">all_metals</span><span class="p">:</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span>
        <span class="n">c_H</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c_H</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c_h</span> <span class="ow">in</span> <span class="n">c_H</span><span class="p">:</span>
                <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">c_h</span><span class="p">,</span> <span class="n">metal</span><span class="p">])</span>
                <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_h</span>

    <span class="k">for</span> <span class="n">bonds</span> <span class="ow">in</span> <span class="n">bonds_to_break</span><span class="p">:</span>
        <span class="n">bond_matrix</span><span class="p">[</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bonds</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bond_matrix</span><span class="p">[</span><span class="n">bonds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">new_ase_graph</span> <span class="o">=</span> <span class="n">matrix2dict</span><span class="p">(</span><span class="n">bond_matrix</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">list_of_connected_components</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">new_ase_graph</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
        <span class="n">N_Graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_dict_of_lists</span><span class="p">(</span><span class="n">new_ase_graph</span><span class="p">)</span>
        <span class="n">list_of_connected_components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">N_Graph</span><span class="p">))]</span>

    <span class="n">all_pm_structures</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_connected_components</span><span class="p">]</span>
    <span class="n">len_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_pm_structures</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_pm_structures</span><span class="p">)):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_pm_structures</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">all_pm_structures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_pm_structures</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_regions</span> <span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">all_regions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">list_of_connected_components</span><span class="p">,</span>
        <span class="n">atom_pairs_at_breaking_point</span><span class="p">,</span>
        <span class="n">porphyrin_checker</span><span class="p">,</span> <span class="n">all_regions</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="ligands_and_metal_clusters">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.ligands_and_metal_clusters">[docs]</a>
<span class="k">def</span> <span class="nf">ligands_and_metal_clusters</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Start by checking whether there are more than 2 layers</span>
<span class="sd">    if yes, select one</span>
<span class="sd">    Here we select the largest connected component</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>

<span class="sd">    **returns:**</span>
<span class="sd">        list_of_connected_components: list of connected components, in which each list contains atom indices</span>
<span class="sd">        atom_pairs_at_breaking_point: Dictionary containing point of disconnection</span>
<span class="sd">        Porpyrin_checker: Boolean showing whether the metal is in the centre of a porpherin</span>
<span class="sd">        Regions: Dictionary of regions.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">graph</span><span class="p">,</span> <span class="n">bond_matrix</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>

    <span class="n">porphyrin_checker</span> <span class="o">=</span> <span class="n">metal_in_porphyrin2</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>

    <span class="n">all_regions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">atom_pairs_at_breaking_point</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">bonds_to_break</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">seen_oxygen</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">carboxylates</span> <span class="o">=</span> <span class="n">find_carboxylates</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">all_sulphates</span> <span class="o">=</span> <span class="n">find_carbonyl_sulphate</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">all_phosphites</span> <span class="o">=</span> <span class="n">find_phosphite</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">all_sulphites</span> <span class="o">=</span> <span class="n">find_sulfides</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">ferocene_metal</span> <span class="o">=</span> <span class="n">all_ferrocene_metals</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">all_metals</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ase_atom</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
    <span class="n">all_metals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_metals</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="o">+</span><span class="n">porphyrin_checker</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">carboxylates</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">oxygen</span> <span class="o">=</span> <span class="n">carboxylates</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">oxy</span> <span class="ow">in</span> <span class="n">oxygen</span><span class="p">:</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">oxy</span><span class="p">]</span>
                         <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">seen_oxygen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oxy</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                        <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">met</span><span class="p">])</span>
                        <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>

        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_sulphates</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">oxygen</span> <span class="o">=</span> <span class="n">all_sulphates</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="c1"># all_carbon_indices = [i for i in connected if ase_atom[i].symbol == &#39;C&#39;]</span>
            <span class="k">for</span> <span class="n">oxy</span> <span class="ow">in</span> <span class="n">oxygen</span><span class="p">:</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">oxy</span><span class="p">]</span>
                         <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                        <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">oxy</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">met</span><span class="p">])</span>
                        <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">oxy</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>

        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_phosphites</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">all__n_indices</span> <span class="o">=</span> <span class="n">all_phosphites</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">phos</span> <span class="ow">in</span> <span class="n">all__n_indices</span><span class="p">:</span>
                <span class="n">metals</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">phos</span><span class="p">]</span>
                          <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metals</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">phos</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">phos</span><span class="p">,</span> <span class="n">met</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_sulphites</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">all__n_indices</span> <span class="o">=</span> <span class="n">all_sulphites</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">sulphur</span> <span class="ow">in</span> <span class="n">all__n_indices</span><span class="p">:</span>
                <span class="n">metals</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">sulphur</span><span class="p">]</span>
                          <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metals</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">sulphur</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">sulphur</span><span class="p">,</span> <span class="n">met</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">carbon_metal</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
            <span class="n">carbon_metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">carbon_metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">carbon_metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">carbon_metal</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">met</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
            <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">atoms</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">porphyrin_checker</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">,</span> <span class="n">met</span><span class="p">])</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                <span class="c1"># atom_pairs_at_breaking_point [metal[0]] = atoms</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_sulphites</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">atoms</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                            <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">met</span><span class="p">])</span>
                            <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
            <span class="c1"># if not atoms in Seen_oxygen:</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
            <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
            <span class="n">Nitrogen</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>
            <span class="n">carbon</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">carbon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">,</span> <span class="n">met</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Nitrogen</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">n_carbon</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">Nitrogen</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_carbon</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                        <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>
                        <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">,</span> <span class="n">met</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">carbon</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metal</span><span class="p">:</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atoms</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">met</span><span class="p">])</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">met</span>

        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
            <span class="c1"># Find the carbon closest to P, which is not bonded to a metal and cut</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_phosphites</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">atoms</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
                             <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                <span class="n">metal_oxy</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
                             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">]</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">metal_oxy</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                <span class="n">closest_atoms</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([[[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">atoms</span> <span class="ow">and</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span>
                                    <span class="n">transition_metals</span><span class="p">()]</span><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">],</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">closest_atoms</span><span class="p">:</span>
                    <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frag</span><span class="p">)</span>
                    <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">frag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># In special cases some carbon and hydrogen get very closed to metals</span>
    <span class="c1"># So in such case it is important to clear this</span>
    <span class="k">for</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">all_metals</span><span class="p">:</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span>
        <span class="n">c_H</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connected</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c_H</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c_h</span> <span class="ow">in</span> <span class="n">c_H</span><span class="p">:</span>
                <span class="n">bonds_to_break</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">c_h</span><span class="p">,</span> <span class="n">metal</span><span class="p">])</span>
                <span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_h</span>

    <span class="k">for</span> <span class="n">bonds</span> <span class="ow">in</span> <span class="n">bonds_to_break</span><span class="p">:</span>
        <span class="n">bond_matrix</span><span class="p">[</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bonds</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bond_matrix</span><span class="p">[</span><span class="n">bonds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">new_ase_graph</span> <span class="o">=</span> <span class="n">matrix2dict</span><span class="p">(</span><span class="n">bond_matrix</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">list_of_connected_components</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">new_ase_graph</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
        <span class="n">N_Graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_dict_of_lists</span><span class="p">(</span><span class="n">new_ase_graph</span><span class="p">)</span>
        <span class="n">list_of_connected_components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">N_Graph</span><span class="p">))]</span>

    <span class="n">all_pm_structures</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_connected_components</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_pm_structures</span><span class="p">)):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_pm_structures</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">all_pm_structures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_pm_structures</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_regions</span> <span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">all_regions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>

    <span class="k">return</span> <span class="n">list_of_connected_components</span><span class="p">,</span> <span class="n">atom_pairs_at_breaking_point</span><span class="p">,</span> <span class="n">porphyrin_checker</span><span class="p">,</span> <span class="n">all_regions</span></div>



<div class="viewcode-block" id="is_rodlike">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.is_rodlike">[docs]</a>
<span class="k">def</span> <span class="nf">is_rodlike</span><span class="p">(</span><span class="n">metal_sbu</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Simple test to check whether a metal sbu is a rodlike MOF</span>

<span class="sd">    **parameter:**</span>
<span class="sd">        metal_sbu : ase_atom</span>

<span class="sd">    **returns:**</span>
<span class="sd">        bool : True if the metal sbu is a rodlike MOF, False otherwise</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">rod_check</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ijk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cells</span><span class="p">):</span>
        <span class="n">rod</span> <span class="o">=</span> <span class="n">metal_sbu</span> <span class="o">*</span> <span class="n">ijk</span>
        <span class="n">graph</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">rod</span><span class="p">)</span>
        <span class="n">list_of_connected_components</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_connected_components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rod_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rod_check</span></div>



<div class="viewcode-block" id="all_ferrocene_metals">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.all_ferrocene_metals">[docs]</a>
<span class="k">def</span> <span class="nf">all_ferrocene_metals</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function to find metals corresponding to ferrocene.</span>
<span class="sd">    These metals should not be considered during mof-constructions</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>
<span class="sd">        graph : dictionary containing neigbour lists</span>

<span class="sd">    **returns:**</span>
<span class="sd">        list_of_metals: list of indices of ferrocene metals</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">list_of_metals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">graph</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">atom_index</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">number_of_carbons</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">neigbour</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">neigbour</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                        <span class="n">number_of_carbons</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">number_of_carbons</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">list_of_metals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">list_of_metals</span></div>



<div class="viewcode-block" id="is_ferrocene">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.is_ferrocene">[docs]</a>
<span class="k">def</span> <span class="nf">is_ferrocene</span><span class="p">(</span><span class="n">metal_sbu</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple script to check whether a metal_sbu is ferrocene</span>

<span class="sd">    **parameter:**</span>
<span class="sd">        metal_sbu : ase_atom</span>
<span class="sd">        graph : dictionary containing neigbour lists</span>

<span class="sd">    **returns:**</span>
<span class="sd">        bool : True if the metal_sbu is ferrocene, False otherwise</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">verdict</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">all_connectivity</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">connectivity</span> <span class="ow">in</span> <span class="n">all_connectivity</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">carbons</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">bondedAtomIndex</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">metal_sbu</span><span class="p">[</span><span class="n">bondedAtomIndex</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                    <span class="n">carbons</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">carbons</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">verdict</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verdict</span><span class="p">)</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">correct</span></div>



<div class="viewcode-block" id="is_paddlewheel">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.is_paddlewheel">[docs]</a>
<span class="k">def</span> <span class="nf">is_paddlewheel</span><span class="p">(</span><span class="n">metal_sbu</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns True if the atom is part of a paddlewheel motif</span>

<span class="sd">    **parameter:**</span>
<span class="sd">        metal_sbu : ase_atom</span>
<span class="sd">        graph : dictionary containing neigbour lists</span>

<span class="sd">    **returns:**</span>
<span class="sd">        bool : True if the metal_sbu is part of a paddlewheel motif, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">verdict</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">all_connectivity</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">connectivity</span> <span class="ow">in</span> <span class="n">all_connectivity</span><span class="p">:</span>
        <span class="n">metalNeighbours</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">oxygenNeighbours</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">bondedAtomIndex</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metal_sbu</span><span class="p">[</span><span class="n">bondedAtomIndex</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">():</span>
                <span class="n">metalNeighbours</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">metal_sbu</span><span class="p">[</span><span class="n">bondedAtomIndex</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
                <span class="n">oxygenNeighbours</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">metalNeighbours</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">oxygenNeighbours</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">&gt;=</span>\
                <span class="mi">5</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">verdict</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verdict</span><span class="p">)</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">correct</span></div>



<div class="viewcode-block" id="is_paddlewheel_with_water">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.is_paddlewheel_with_water">[docs]</a>
<span class="k">def</span> <span class="nf">is_paddlewheel_with_water</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns True if the atom is part of a paddle wheel with water motif</span>

<span class="sd">    **parameter:**</span>
<span class="sd">        ase_atom : ase_atom</span>
<span class="sd">        graph : dictionary containing neigbour lists</span>

<span class="sd">    **returns:**</span>
<span class="sd">        bool : True if the metal_sbu is part of a paddle wheel with water motif, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">metal</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">verdict</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">():</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">index</span>
            <span class="n">metal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connectivity</span> <span class="k">if</span>
                    <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">verdict</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verdict</span><span class="p">)</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">correct</span></div>



<div class="viewcode-block" id="is_uio66">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.is_uio66">[docs]</a>
<span class="k">def</span> <span class="nf">is_uio66</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns True if the atom is part of a UIO66 motif</span>

<span class="sd">    **parameter:**</span>
<span class="sd">        ase_atom : ase_atom</span>
<span class="sd">        graph : dictionary containing neigbour lists</span>

<span class="sd">    **returns:**</span>
<span class="sd">        bool : True if the metal_sbu is part of a UIO66 motif, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">verdict</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">all_connectivity</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">connectivity</span> <span class="ow">in</span> <span class="n">all_connectivity</span><span class="p">:</span>
        <span class="n">metal_neighbours</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">oxygen_neighbours</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">bonded_atom_index</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">bonded_atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">():</span>
                <span class="n">metal_neighbours</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">bonded_atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
                <span class="n">oxygen_neighbours</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">metal_neighbours</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="p">(</span><span class="n">oxygen_neighbours</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">oxygen_neighbours</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span>\
                <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">):</span>
            <span class="n">verdict</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verdict</span><span class="p">)</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">correct</span></div>



<div class="viewcode-block" id="is_irmof">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.is_irmof">[docs]</a>
<span class="k">def</span> <span class="nf">is_irmof</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns True if the atom is part of a IRMOF motif</span>

<span class="sd">    **parameter:**</span>
<span class="sd">        ase_atom : ase_atom</span>
<span class="sd">        graph : dictionary containing neigbour lists</span>

<span class="sd">    **returns:**</span>
<span class="sd">        bool : True if the metal_sbu is part of a IRMOF motif, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">verdict</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">index</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">([</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connectivity</span> <span class="k">if</span>
                                               <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>

                <span class="n">verdict</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verdict</span><span class="p">)</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">correct</span></div>



<div class="viewcode-block" id="is_mof32">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.is_mof32">[docs]</a>
<span class="k">def</span> <span class="nf">is_mof32</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns True if the atom is part of a MOF32 motif</span>

<span class="sd">    **parameter:**</span>
<span class="sd">        ase_atom : ase_atom</span>
<span class="sd">        graph : dictionary containing neigbour lists</span>

<span class="sd">    **returns:**</span>
<span class="sd">        bool : True if the metal_sbu is part of a MOF32 motif, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">metal</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">verdict</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">ase_atom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atoms</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">():</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">index</span>
            <span class="n">metal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connectivity</span> <span class="k">if</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">verdict</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verdict</span><span class="p">)</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">correct</span></div>



<div class="viewcode-block" id="rod_manipulation">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.rod_manipulation">[docs]</a>
<span class="k">def</span> <span class="nf">rod_manipulation</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">checker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Script to adjust Rodlike sbus.</span>
<span class="sd">    1) Its collects the axis responsible for expanding the rod</span>
<span class="sd">    2) It shifts all coordinates to the axis</span>
<span class="sd">    3) It rotates the rod to lie in the directions of expansion,</span>

<span class="sd">    **parameter:**</span>
<span class="sd">        ase_atom : ASE atoms object</span>
<span class="sd">        checker : list of indices of atoms responsible for rod expansion</span>

<span class="sd">    **returns:**</span>
<span class="sd">        ase_atom : ASE atoms object with adjusted coordinates</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">cell</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">value_index</span> <span class="o">=</span> <span class="n">checker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cell_value</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="n">value_index</span><span class="p">]</span>
    <span class="n">new_cell</span> <span class="o">=</span> <span class="n">move2front</span><span class="p">(</span><span class="n">checker</span><span class="p">,</span> <span class="n">cell_value</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="o">.</span><span class="n">positions</span> <span class="o">-</span> <span class="n">cell_value</span>
    <span class="n">new_position</span> <span class="o">=</span> <span class="n">move2front</span><span class="p">(</span><span class="n">checker</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">ase_atom</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">new_position</span>
    <span class="k">return</span> <span class="n">ase_atom</span><span class="p">,</span> <span class="n">new_cell</span></div>



<div class="viewcode-block" id="find_unique_building_units">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.find_unique_building_units">[docs]</a>
<span class="k">def</span> <span class="nf">find_unique_building_units</span><span class="p">(</span><span class="n">list_of_connected_components</span><span class="p">,</span> <span class="n">atom_pairs_at_breaking_point</span><span class="p">,</span>
                               <span class="n">ase_atom</span><span class="p">,</span> <span class="n">porphyrin_checker</span><span class="p">,</span> <span class="n">all_regions</span><span class="p">,</span> <span class="n">wrap_system</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cheminfo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_dummy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function that identifies and processes unique building units within a MOF.</span>
<span class="sd">    This function deconstructs a MOF into its constituent building unit and identifies</span>
<span class="sd">    unique building units. It can also</span>
<span class="sd">    1. wrap the system into the unit cell,</span>
<span class="sd">    2. add dummy atoms to neutralize the building units,</span>
<span class="sd">    3. compute cheminformatics data using Open Babel.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        list_of_connected_components : list of connected components</span>
<span class="sd">        atom_pairs_at_breaking_point : dictionary of atom pairs at breaking point</span>
<span class="sd">        ase_atom : ASE atoms object</span>
<span class="sd">        porphyrin_checker : list of indices of porphyrins</span>
<span class="sd">        all_regions : dictionary of regions</span>
<span class="sd">        wrap_system : boolean, default True</span>
<span class="sd">        cheminfo : boolean, default False</span>
<span class="sd">        add_dummy: boolean, default False</span>
<span class="sd">        add_dummy keyword enables the addition of dumnmy atoms which can then be replaced</span>
<span class="sd">        by hydrogen to neutralize the building blocks.</span>

<span class="sd">    **returns:**</span>
<span class="sd">        mof_metal: list of metal indices</span>
<span class="sd">        mof_linker: list of linker indices</span>
<span class="sd">        concentration: dictionary of concentration of building units</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mof_metal</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mof_linker</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># concentration = {}</span>
    <span class="n">building_unit_regions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_regions</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">frag</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_regions</span> <span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">list_of_connected_components</span><span class="p">[</span><span class="n">all_regions</span><span class="p">[</span><span class="n">frag</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">all_breaking_point</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">atom_pairs_at_breaking_point</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span>
        <span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">atom_pairs_at_breaking_point</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">point_of_extension</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_breaking_point</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">components</span><span class="p">]</span>
        <span class="n">mapped_indices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)))])</span>
        <span class="n">molecule_to_write</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">components</span><span class="p">]</span>
        <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;point_of_extension&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mapped_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">point_of_extension</span><span class="p">]</span>

        <span class="n">molecule_for_prop</span> <span class="o">=</span> <span class="n">molecule_to_write</span>
        <span class="k">if</span> <span class="n">wrap_system</span> <span class="ow">and</span> <span class="n">add_dummy</span><span class="p">:</span>
            <span class="n">dummy_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_key_or_value</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">atom_pairs_at_breaking_point</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">point_of_extension</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">dummy_idx</span><span class="p">:</span>
                <span class="n">dummy_mol</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">dummy_idx</span><span class="p">]</span>
                <span class="n">len_mole_without_dummy</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_to_write</span><span class="p">)</span>

                <span class="n">molecule_to_write</span> <span class="o">+=</span> <span class="n">dummy_mol</span>
                <span class="n">molecule_to_write</span> <span class="o">=</span> <span class="n">wrap_systems_in_unit_cell</span><span class="p">(</span>
                    <span class="n">molecule_to_write</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_mole_without_dummy</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_to_write</span><span class="p">)):</span>
                    <span class="n">molecule_to_write</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>

                <span class="n">molecule_for_prop</span> <span class="o">=</span> <span class="n">molecule_to_write</span><span class="p">[:</span><span class="n">len_mole_without_dummy</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">wrap_system</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">add_dummy</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">molecule_to_write</span> <span class="o">=</span> <span class="n">wrap_systems_in_unit_cell</span><span class="p">(</span><span class="n">molecule_to_write</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cheminfo</span><span class="p">:</span>
            <span class="n">smi</span><span class="p">,</span> <span class="n">chem_inchi</span><span class="p">,</span> <span class="n">chem_inchiKey</span> <span class="o">=</span> <span class="n">compute_openbabel_cheminformatic</span><span class="p">(</span>
                <span class="n">molecule_for_prop</span><span class="p">)</span>
            <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;smi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smi</span>
            <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;inchi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">chem_inchi</span><span class="p">)</span>
            <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">chem_inchiKey</span><span class="p">)</span>

            <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">chem_inchiKey</span><span class="p">)</span>
        <span class="n">atom_indices_mapping</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">list_of_connected_components</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_regions</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
        <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;atom_indices_mapping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_indices_mapping</span>

        <span class="c1"># if add_dummy:</span>
        <span class="c1">#     dummy_idx = [find_key_or_value(i, atom_pairs_at_breaking_point) for i in  point_of_extension]</span>
        <span class="c1">#     dummy_mol = ase_atom[dummy_idx]</span>
        <span class="c1">#     # if wrap_system:</span>
        <span class="c1">#     #     dummy_mol = wrap_systems_in_unit_cell(dummy_mol)</span>
        <span class="c1">#     for atom in dummy_mol:</span>
        <span class="c1">#         atom.symbol = &#39;X&#39;</span>
        <span class="c1">#     molecule_to_write += dummy_mol</span>

        <span class="n">metal</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">molecule_for_prop</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">(</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">porphyrin_checker</span><span class="p">]</span>
        <span class="n">non_ferocene_metal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">graph_sbu</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">molecule_for_prop</span><span class="p">)</span>
            <span class="c1"># Check whether the metal sbu is a rod mof. If is it is rod mof,</span>
            <span class="c1"># we rotate and aligne the sbu such that the axis of rotation will be the a-axis.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">is_rodlike</span><span class="p">(</span><span class="n">molecule_for_prop</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sbu_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rodlike&#39;</span>
            <span class="k">elif</span> <span class="n">is_paddlewheel</span><span class="p">(</span><span class="n">molecule_for_prop</span><span class="p">,</span> <span class="n">graph_sbu</span><span class="p">):</span>
                <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sbu_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;paddlewheel&#39;</span>
            <span class="k">elif</span> <span class="n">is_paddlewheel_with_water</span><span class="p">(</span><span class="n">molecule_for_prop</span><span class="p">,</span> <span class="n">graph_sbu</span><span class="p">):</span>
                <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sbu_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;paddlewheel_with_water&#39;</span>
            <span class="k">elif</span> <span class="n">is_uio66</span><span class="p">(</span><span class="n">molecule_for_prop</span><span class="p">,</span> <span class="n">graph_sbu</span><span class="p">):</span>
                <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sbu_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;UIO66_sbu&#39;</span>
            <span class="k">elif</span> <span class="n">is_mof32</span><span class="p">(</span><span class="n">molecule_for_prop</span><span class="p">,</span> <span class="n">graph_sbu</span><span class="p">):</span>
                <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sbu_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MOF32_sbu&#39;</span>
            <span class="k">elif</span> <span class="n">is_irmof</span><span class="p">(</span><span class="n">molecule_for_prop</span><span class="p">,</span> <span class="n">graph_sbu</span><span class="p">):</span>
                <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sbu_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;IRMOF_sbu&#39;</span>
            <span class="k">elif</span> <span class="n">is_ferrocene</span><span class="p">(</span><span class="n">molecule_for_prop</span><span class="p">,</span> <span class="n">graph_sbu</span><span class="p">):</span>
                <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sbu_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ferrocenelike&#39;</span>
                <span class="n">ferocene_metal</span> <span class="o">=</span> <span class="n">all_ferrocene_metals</span><span class="p">(</span>
                    <span class="n">molecule_for_prop</span><span class="p">,</span> <span class="n">graph_sbu</span><span class="p">)</span>
                <span class="n">non_ferocene_metal</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ferocene_metal</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_ferocene_metal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">mof_linker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">molecule_to_write</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sbu_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;still checking!&#39;</span>
            <span class="n">mof_metal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">molecule_to_write</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">mof_linker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">molecule_to_write</span><span class="p">)</span>
        <span class="n">building_unit_regions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule_to_write</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;atom_indices_mapping&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mof_metal</span><span class="p">,</span> <span class="n">mof_linker</span><span class="p">,</span> <span class="n">building_unit_regions</span></div>



<div class="viewcode-block" id="metal_coordination_number">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.metal_coordination_number">[docs]</a>
<span class="k">def</span> <span class="nf">metal_coordination_number</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Extract coordination number of central metal</span>

<span class="sd">    **paramters:**</span>
<span class="sd">        ase_atom : ASE atoms object</span>

<span class="sd">    **returns:**</span>
<span class="sd">        metal_elt : list of metal elements</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">metal_coordination</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">graph</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>
    <span class="n">porph_indices</span> <span class="o">=</span> <span class="n">metal_in_porphyrin2</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">metal_indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ase_atom</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
    <span class="n">metal_elt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal_indices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">porph_indices</span> <span class="ow">and</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metal_elt</span><span class="p">:</span>
            <span class="n">metal_elt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>
            <span class="n">metal_coordination</span><span class="p">[</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">metal_elt</span><span class="p">,</span> <span class="n">metal_coordination</span></div>



<div class="viewcode-block" id="metal_coordination_enviroment">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.metal_coordination_enviroment">[docs]</a>
<span class="k">def</span> <span class="nf">metal_coordination_enviroment</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Find the enviroment of a metal</span>

<span class="sd">    **paramters:**</span>
<span class="sd">        ase_atom : ASE atoms object</span>

<span class="sd">    **returns:**</span>
<span class="sd">        metal_elt : list of metal elements</span>
<span class="sd">        metal_enviroment : dict where key is metal element and value is list of neighboring elements</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">metal_enviroment</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">graph</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>
    <span class="n">porph_indices</span> <span class="o">=</span> <span class="n">metal_in_porphyrin2</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">metal_indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ase_atom</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">transition_metals</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metal_indices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">porph_indices</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>
            <span class="n">metal_enviroment</span><span class="p">[</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ase_atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">metal_enviroment</span></div>



<div class="viewcode-block" id="mof_regions">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.mof_regions">[docs]</a>
<span class="k">def</span> <span class="nf">mof_regions</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">list_of_connected_components</span><span class="p">,</span> <span class="n">atom_pairs_at_breaking_point</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function to map all atom indices to exact position in which the find themselves in the MOF.</span>
<span class="sd">    This function is used to partition a MOF into regions that correspond to unique</span>
<span class="sd">    unique building units.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom: ASE atom</span>
<span class="sd">        list_of_connected_components : list of list, wherein each list correspond to atom indices of a specific building unit</span>
<span class="sd">        atom_pairs_at_breaking_point: dictionary containing pairs of atoms from which the bonds were broken</span>

<span class="sd">    **returns:**</span>
<span class="sd">        Move an index from any position in the list to the front</span>
<span class="sd">        The function is important to set the cell of a rodmof to point in the</span>
<span class="sd">        a-axis. Such that the system can be grow along this axis</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">all_regions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">xis_regions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">all_pm_structures</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_connected_components</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_pm_structures</span><span class="p">)):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_pm_structures</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">all_pm_structures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_pm_structures</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">all_regions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">all_regions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_regions</span> <span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
        <span class="n">frag</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_regions</span> <span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">list_of_connected_components</span><span class="p">[</span><span class="n">all_regions</span><span class="p">[</span><span class="n">frag</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="p">[[</span><span class="n">atom_pairs_at_breaking_point</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">atom_pairs_at_breaking_point</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">]</span>
        <span class="n">xis_regions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">dummy</span>
    <span class="k">return</span> <span class="n">all_regions</span><span class="p">,</span> <span class="n">xis_regions</span></div>



<div class="viewcode-block" id="wrap_systems_in_unit_cell">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.wrap_systems_in_unit_cell">[docs]</a>
<span class="k">def</span> <span class="nf">wrap_systems_in_unit_cell</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">skin</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A simple aglorithm to reconnnect all atoms wrapped in a periodic</span>
<span class="sd">    boundary condition such that all atoms outside the box will appear reconnected.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        ase_atom : ASE atoms object</span>
<span class="sd">        max_iter : int, optional (default=30) Maximum number of iterations for reconnection</span>
<span class="sd">        skin : float, optional (default=0.3) Skin distance for bond reconnection</span>

<span class="sd">    **returns:**</span>
<span class="sd">        ase_atom : ASE atoms object with reconnected atoms wrapped in a periodic boundary condition</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">ase_atom</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">()):</span>
        <span class="k">return</span> <span class="n">ase_atom</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_position</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">wrap_positions</span><span class="p">(</span><span class="n">ase_atom</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="n">ase_atom</span><span class="o">.</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">pretty_translation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-07</span><span class="p">)</span>
        <span class="n">ase_atom</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">new_position</span>

        <span class="n">graph</span><span class="p">,</span> <span class="n">bond_matrix</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">nl</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">:</span>
                <span class="n">check</span> <span class="o">=</span> <span class="n">covalent_radius</span><span class="p">(</span>
                    <span class="n">ase_atom</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span> <span class="o">+</span> <span class="n">covalent_radius</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">nl</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span> <span class="o">+</span> <span class="n">skin</span>
                <span class="n">bond</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ase_atom</span><span class="o">.</span><span class="n">get_distance</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">nl</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bond</span> <span class="o">&gt;</span> <span class="n">check</span><span class="p">:</span>
                    <span class="n">bond_matrix</span><span class="p">[</span><span class="n">atom</span><span class="p">][</span><span class="n">nl</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">new_ase_graph</span> <span class="o">=</span> <span class="n">matrix2dict</span><span class="p">(</span><span class="n">bond_matrix</span><span class="p">)</span>
        <span class="n">list_of_connected_components</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">new_ase_graph</span><span class="p">)</span>
        <span class="n">number_of_iterations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_connected_components</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">all_len</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_connected_components</span><span class="p">]</span>
            <span class="n">max_index</span> <span class="o">=</span> <span class="n">all_len</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">all_len</span><span class="p">))</span>
            <span class="n">Root</span> <span class="o">=</span> <span class="n">list_of_connected_components</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span>
            <span class="n">list_of_connected_components</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">max_index</span><span class="p">)</span>
            <span class="n">All_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">list_of_connected_components</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">Root</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">nl</span> <span class="ow">in</span> <span class="n">All_sum</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nl</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">nl</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">ase_atom</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>
                        <span class="n">mic_vector</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">find_mic</span><span class="p">(</span>
                            <span class="n">v</span><span class="p">,</span> <span class="n">ase_atom</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(),</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">ase_atom</span><span class="p">[</span><span class="n">nl</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">mic_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
                            <span class="n">ase_atom</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>

            <span class="n">graph</span><span class="p">,</span> <span class="n">bond_matrix</span> <span class="o">=</span> <span class="n">compute_ase_neighbour</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">nl</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">:</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="n">covalent_radius</span><span class="p">(</span>
                        <span class="n">ase_atom</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span> <span class="o">+</span> <span class="n">covalent_radius</span><span class="p">(</span><span class="n">ase_atom</span><span class="p">[</span><span class="n">nl</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span> <span class="o">+</span> <span class="n">skin</span>
                    <span class="n">bond</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ase_atom</span><span class="o">.</span><span class="n">get_distance</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">nl</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">bond</span> <span class="o">&gt;</span> <span class="n">check</span><span class="p">:</span>
                        <span class="n">bond_matrix</span><span class="p">[</span><span class="n">atom</span><span class="p">][</span><span class="n">nl</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">new_ase_graph</span> <span class="o">=</span> <span class="n">matrix2dict</span><span class="p">(</span><span class="n">bond_matrix</span><span class="p">)</span>
            <span class="n">list_of_connected_components</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">new_ase_graph</span><span class="p">)</span>
            <span class="n">number_of_iterations</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">number_of_iterations</span> <span class="o">==</span> <span class="n">max_iter</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">ase_atom</span></div>



<div class="viewcode-block" id="angle_tolerance_to_rad">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.angle_tolerance_to_rad">[docs]</a>
<span class="k">def</span> <span class="nf">angle_tolerance_to_rad</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert angle from degrees to radians with tolerance.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        angle: float</span>
<span class="sd">            Angle in degrees.</span>
<span class="sd">        tolerance: float</span>
<span class="sd">            Tolerance in degrees, default is 5.</span>

<span class="sd">    **returns:**</span>
<span class="sd">        bond_angle_rad: float</span>
<span class="sd">        Adjusted angle in radians.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">angle_variation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">tolerance</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
    <span class="n">adjusted_bond_angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">+</span> <span class="n">angle_variation</span>
    <span class="n">bond_angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">adjusted_bond_angle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bond_angle_rad</span></div>



<div class="viewcode-block" id="find_key_or_value">
<a class="viewcode-back" href="../../api_reference.html#mofstructure.mofdeconstructor.find_key_or_value">[docs]</a>
<span class="k">def</span> <span class="nf">find_key_or_value</span><span class="p">(</span><span class="n">key_or_value</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for a key or value in a dictionary. If the key or value is</span>
<span class="sd">    found, returns the corresponding value or key.</span>

<span class="sd">    **parameters:**</span>
<span class="sd">        key_or_value : int or str</span>
<span class="sd">        dictionary : dict</span>

<span class="sd">    **returns:**</span>
<span class="sd">        The corresponding value or key if found, otherwise None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key_or_value</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dictionary</span><span class="p">[</span><span class="n">key_or_value</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">key_or_value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">key</span>

    <span class="k">return</span> <span class="kc">None</span></div>

<span class="c1"># def add_dummy_to_point_of_extension(ase_atom, point_of_extension, mapped_indices):</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#     Add a dummy atom to the point of extension, ensuring that it forms an angle</span>
<span class="c1">#     of approximately 120° with the central atom and its neighbors, and is always</span>
<span class="c1">#     added outward.</span>

<span class="c1">#     parameters</span>
<span class="c1">#     ----------</span>
<span class="c1">#     ase_atom: Atoms object</span>
<span class="c1">#         The original atom structure.</span>
<span class="c1">#     point_of_extension: list</span>
<span class="c1">#         List of indices where dummy atoms are to be added.</span>
<span class="c1">#     mapped_indices: dict</span>
<span class="c1">#         Dictionary mapping internal indices to atomic indices.</span>

<span class="c1">#     returns</span>
<span class="c1">#     -------</span>
<span class="c1">#     new_atom: Atoms object</span>
<span class="c1">#         Atoms object containing the original atoms plus the newly added dummy atoms.</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#     distance = 1.0  # Distance for adding new dummy atom</span>
<span class="c1">#     all_positions = []</span>

<span class="c1">#     # Compute neighbor information</span>
<span class="c1">#     graph, bond_matrix = compute_ase_neighbour(ase_atom)</span>

<span class="c1">#     for idx in point_of_extension:</span>
<span class="c1">#         atom_idx = mapped_indices[idx]</span>
<span class="c1">#         neighbours = graph[atom_idx].tolist()</span>
<span class="c1">#         x0, y0, z0 = ase_atom[atom_idx].position</span>

<span class="c1">#         if len(neighbours) == 1:</span>
<span class="c1">#             # Add the dummy atom directly along the x-axis if there&#39;s only one neighbor</span>
<span class="c1">#             x = x0 + distance</span>
<span class="c1">#             y = y0</span>
<span class="c1">#             z = z0</span>
<span class="c1">#             new_position = [x, y, z]</span>
<span class="c1">#             all_positions.append(new_position)</span>

<span class="c1">#         elif len(neighbours) == 2:</span>
<span class="c1">#             # Get the positions of the two neighboring atoms</span>
<span class="c1">#             pos1 = ase_atom[neighbours[0]].position</span>
<span class="c1">#             pos2 = ase_atom[neighbours[1]].position</span>

<span class="c1">#             # Calculate vectors from the central atom to the neighbors</span>
<span class="c1">#             vec1 = pos1 - np.array([x0, y0, z0])</span>
<span class="c1">#             vec2 = pos2 - np.array([x0, y0, z0])</span>

<span class="c1">#             # Normalize the vectors</span>
<span class="c1">#             vec1 /= np.linalg.norm(vec1)</span>
<span class="c1">#             vec2 /= np.linalg.norm(vec2)</span>

<span class="c1">#             # Compute the normal to the plane (cross product of vec1 and vec2)</span>
<span class="c1">#             normal = np.cross(vec1, vec2)</span>
<span class="c1">#             normal /= np.linalg.norm(normal)</span>

<span class="c1">#             # Calculate the bisector direction (outward)</span>
<span class="c1">#             bisector = (vec1 + vec2) / np.linalg.norm(vec1 + vec2)</span>

<span class="c1">#             # Ensure the bisector points outward</span>
<span class="c1">#             if np.dot(bisector, normal) &lt; 0:</span>
<span class="c1">#                 bisector = -bisector</span>

<span class="c1">#             # Rotate the bisector by 120 degrees to get the new atom&#39;s position</span>
<span class="c1">#             bond_angle_rad = angle_tolerance_to_rad(120)  # Desired angle</span>

<span class="c1">#             # Use the rotation matrix for in-plane rotation around the normal</span>
<span class="c1">#             cos_angle = np.cos(bond_angle_rad)</span>
<span class="c1">#             sin_angle = np.sin(bond_angle_rad)</span>
<span class="c1">#             rotation_matrix = np.array([</span>
<span class="c1">#                 [cos_angle + normal[0]**2 * (1 - cos_angle), normal[0] * normal[1] * (1 - cos_angle) - normal[2] * sin_angle, normal[0] * normal[2] * (1 - cos_angle) + normal[1] * sin_angle],</span>
<span class="c1">#                 [normal[1] * normal[0] * (1 - cos_angle) + normal[2] * sin_angle, cos_angle + normal[1]**2 * (1 - cos_angle), normal[1] * normal[2] * (1 - cos_angle) - normal[0] * sin_angle],</span>
<span class="c1">#                 [normal[2] * normal[0] * (1 - cos_angle) - normal[1] * sin_angle, normal[2] * normal[1] * (1 - cos_angle) + normal[0] * sin_angle, cos_angle + normal[2]**2 * (1 - cos_angle)]</span>
<span class="c1">#             ])</span>

<span class="c1">#             new_direction = np.dot(rotation_matrix, bisector)</span>
<span class="c1">#             new_position = np.array([x0, y0, z0]) + distance * new_direction</span>

<span class="c1">#             all_positions.append(new_position)</span>

<span class="c1">#     # Create a new Atoms object for the dummy atoms</span>
<span class="c1">#     symbols = [&#39;X&#39; for _ in all_positions]  # Use &#39;X&#39; as a placeholder symbol for dummy atoms</span>
<span class="c1">#     new_atom = Atoms(symbols=symbols, positions=all_positions)</span>

<span class="c1">#     return new_atom</span>


<span class="c1"># def calculate_coordinates_atom(atom_type, bond_angle, atom_position, distance=0.9, tolerance=5):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Function to calculate to compute the coordinates of atoms to add to a give atoms. This</span>
<span class="c1">#     will mostly be used to add hydrogen atoms or dummies.</span>
<span class="c1">#     parameters</span>
<span class="c1">#     ----------</span>
<span class="c1">#     atom_type: str</span>
<span class="c1">#     bond_angle: float</span>
<span class="c1">#     atom_position: ndarray</span>
<span class="c1">#     distance: float</span>
<span class="c1">#     tolerance: float</span>
<span class="c1">#     returns the coordinates of the atoms</span>

<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     angle_variation = np.random.uniform(-tolerance, tolerance)</span>
<span class="c1">#     adjusted_bond_angle = bond_angle + angle_variation</span>
<span class="c1">#     bond_angle_rad = np.deg2rad(adjusted_bond_angle)</span>

<span class="c1">#     x0, y0, z0 = atom_position</span>

<span class="c1">#     if atom_type == &quot;sp3&quot;:</span>
<span class="c1">#         # Tetrahedral: Place the hydrogen along the x-axis at distance d</span>
<span class="c1">#         x = x0 + distance</span>
<span class="c1">#         y = y0</span>
<span class="c1">#         z = z0</span>
<span class="c1">#     elif atom_type == &quot;sp2&quot;:</span>
<span class="c1">#         # Trigonal planar: Place the hydrogen in the xy-plane</span>
<span class="c1">#         x = x0 + distance * np.cos(bond_angle_rad / 2)</span>
<span class="c1">#         y = y0 + distance * np.sin(bond_angle_rad / 2)</span>
<span class="c1">#         z = z0</span>
<span class="c1">#     elif atom_type == &quot;sp&quot;:</span>
<span class="c1">#         # Linear: Place the hydrogen along the x-axis at distance d</span>
<span class="c1">#         x = x0 + distance</span>
<span class="c1">#         y = y0</span>
<span class="c1">#         z = z0</span>
<span class="c1">#     elif atom_type == &quot;trigonal_pyramidal&quot;:</span>
<span class="c1">#         # Trigonal pyramidal: Place the hydrogen in the xz-plane</span>
<span class="c1">#         x = x0 + distance * np.cos(bond_angle_rad / 2)</span>
<span class="c1">#         y = y0</span>
<span class="c1">#         z = z0 + distance * np.sin(bond_angle_rad / 2)</span>
<span class="c1">#     elif atom_type == &quot;bent&quot;:</span>
<span class="c1">#         # Bent: Place the hydrogen in the xz-plane</span>
<span class="c1">#         x = x0 + distance * np.cos(bond_angle_rad / 2)</span>
<span class="c1">#         y = y0</span>
<span class="c1">#         z = z0 + distance * np.sin(bond_angle_rad / 2)</span>
<span class="c1">#     else:</span>
<span class="c1">#         raise ValueError(&quot;Unsupported atom type&quot;)</span>

<span class="c1">#     return [x, y, z]</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">mofstructure</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html#running-on-the-command-line">Running on the Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html#using-mofstructure-as-a-library">Using <cite>mofstructure</cite> as a Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">How to Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html#run-on-the-command-line">Run on the Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html#processing-multiple-cif-files">Processing Multiple CIF Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html#use-as-a-library">Use as a Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../updates.html">Updates Version 0.1.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../updates.html#updates-version-0-1-5">Updates Version 0.1.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../updates.html#updates-version-0-1-6">Updates Version 0.1.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../updates.html#updates-version-0-1-7">Updates Version 0.1.7</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Dinga Wonanke.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>